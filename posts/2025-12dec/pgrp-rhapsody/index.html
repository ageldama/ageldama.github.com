<!DOCTYPE html>
<html><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"><title>process-tree 정리의 rhapsody - 아겔로그</title><meta name="hugo-gen-timestamp" content="1770717491">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="view-transition" content="same-origin">
    <meta name="description" content="

발단




상황배경:

내 프로그램은 순박하게 yt-dlp을 실행한다.
실행된 yt-dlp은 또 내가 지정한대로, 실제 다운로더로서 aria2c을
실행하고,
이렇게 실행된 aria2c은 다시금 내가 지정한대로, 충실히, 자기자신을
10개 정도의 동시프로세스으로 복제하여 병렬실행된다.



…그런데…

갑자기 Control-C(SIGINT)을 눌러 내 프로그램을 종료했다.
😕 yt-dlp 프로세스와 그 하위 aria2c 프로세스 10여개는 종료되었을까?




  … yt-dlp, aria2c에 기대하는 behavior은: 그렇다-이다.

  그런데 그렇지 않을 경우도 있을테고(순전히 각 애플리케이션의 처리에
  따를테니까, 플랫폼(예: linux / freebsd)에 따라 그렇게 되지 않는
  경우도 있다. 😑" />
    <meta property="og:image" content=""/>
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/styles.cf6e224503e8604b8cfea063150685f5d1e1e66e9d4705693ef0163e1c529e7d.css"
          integrity="sha256-z24iRQPoYEuM/qBjFQaF9dHh5m6dRwVpPvAWPhxSnn0=" crossorigin="anonymous">
    
    
    
    
    

        
        
        
            
                
                    <script src="/js/bundle.c11f553788e500f0664c8f4de6cd61b730fc0e27c6d1809bc240d1cd7abfdcde.js" integrity="sha256-wR9VN4jlAPBmTI9N5s1htzD8DifG0YCbwkDRzXq/3N4=" crossorigin="anonymous"></script>
                
            
        
    

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Nanum+Gothic+Coding&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR:wght@200..900&display=swap" rel="stylesheet">
</head>
<body hx-boost="true" hx-indicator=".htmx-indicator">
        <div class="htmx-indicator"><div class="spinner"></div></div>

        <div class="container"><header>
    <div class="main ">
        <h1 class="site-title ">
            <a href="https://ageldama.github.io/">아겔로그</a>
        </h1>
    </div>

    <nav>
        
          <div class="search-form">
      <span class="search-loading-indicator" style="display: none;"></span>
      <input id="search-query" name="search-query"
          type="text"
          class="search-query"
          tabindex="1"
          placeholder="🔎 검색 (search)"
          onkeyup="searcher.onSearchKeyup(event)"/>
  </div>

        

        
        <a href="/series/">📚 Series</a>
        
        <a href="/archive/">🗂️ Archive</a>
        
        <a href="/myself/">📨 Contact</a>
        

        
        <button class="dark-mode-btn"
        aria-label="toggle dark-mode"
        onclick="colorscheme.toggle()">color: </button>
<!--button class="snow-mode-btn"
        aria-label="toggle dark-mode"
        onclick="letitsnow(event)">☃️ snow?</button-->

        
    </nav>
</header>





<script>
 
 if (window.navigator.userAgent.indexOf('Trident/') > 0) {
     let urls = [];
     let head = document.getElementsByTagName("head")[0];
     urls.forEach(function(url) {
         let script = document.createElement("script");
         script.src = url;
         head.appendChild(script);
     });
 }
 
</script>

<div class="search">
    <div class="search-results"></div>
</div>


<main>
    <nav class="post-prevnext" aria-label="posts">
    <span class="post-prevnext-side">
        
        <a class="post-prevnext-btn" href="https://ageldama.github.io/posts/2025-12dec/factor-and-io/">⬅️ (주절주절) Factor와 Io</a>
        
    </span>

    <span class="post-prevnext-side">
        
        <a class="post-prevnext-btn" href="https://ageldama.github.io/posts/2025-12dec/reactjs&#43;nextjs-rce/">➡️ (주절주절) react.js / next.js RCE 보안문제와 아기 히틀러 딜레마</a>
        
    </span>
</nav>

    
    <hr class="archive-ruler">
    
    <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">발단</a>
</li>
<li><a href="#headline-2">[접근법] 하위프로세스를 검색하여 다 정리</a>
</li>
<li><a href="#headline-3">[접근법] <code>kill -- -${PGID}</code></a>
<ul>
<li><a href="#headline-4">Session ID와의 차이점?</a>
</li>
</ul>
</li>
<li><a href="#headline-5">[실험] process-group 지정해보기</a>
<ul>
<li><a href="#headline-6">(naïve) <code>system()</code> == 👌</a>
</li>
<li><a href="#headline-7"><code>IPC::Open3</code> == 👌</a>
</li>
<li><a href="#headline-8"><code>fork</code> + <code>exec</code> == 👌</a>
</li>
<li><a href="#headline-9">직접 ⚙️제어하기: <code>setpgrp</code> == 👌</a>
</li>
</ul>
</li>
<li><a href="#headline-10">Windows에서는?</a>
</li>
<li><a href="#headline-11">[Addendum] <code>cgroups</code> – 갑자기 docker &amp; kubernetes</a>
</li>
</ul>
</nav>

    <article>
	<div class="title"><h1 class="title">🐮 process-tree 정리의 rhapsody</h1>
	    <div class="meta">
                <time datetime="2025-12-07" pubdate>
                    2025년12월07일
                </time>
                </div>
        </div>

        

	

	<section class="body">
	    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
발단
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<ol>
<li>
<p>상황배경:</p>
<ol>
<li>내 프로그램은 순박하게 <a href="https://github.com/yt-dlp/yt-dlp">yt-dlp</a>을 실행한다.</li>
<li>실행된 yt-dlp은 또 내가 지정한대로, 실제 다운로더로서 <a href="https://aria2.github.io/">aria2c</a>을
실행하고,</li>
<li>이렇게 실행된 aria2c은 다시금 내가 지정한대로, 충실히, 자기자신을
10개 정도의 동시프로세스으로 복제하여 병렬실행된다.</li>
</ol>
</li>
<li>
<p>…그런데…</p>
<ol>
<li>갑자기 Control-C(<code>SIGINT</code>)을 눌러 내 프로그램을 종료했다.</li>
<li>😕 <span style="text-decoration: underline;">yt-dlp 프로세스와 그 하위 aria2c 프로세스 10여개는 종료되었을까?</span></li>
</ol>
</li>
</ol>
<p>
  … yt-dlp, aria2c에 기대하는 behavior은: <span style="text-decoration: underline;">그렇다</span>-이다.</p>
<p>
  그런데 그렇지 않을 경우도 있을테고(순전히 각 애플리케이션의 처리에
  따를테니까, 플랫폼(예: linux / freebsd)에 따라 그렇게 되지 않는
  경우도 있다. 😑</p>
<p>
  그렇다면, 이런 상황을 제대로 처리하는 &#34;내 프로그램&#34;을 만들 수
  있을까? 🤔</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
[접근법] 하위프로세스를 검색하여 다 정리
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>너무 당연해 보이고, 심지어 자연스러운 발상에 기반한 접근법.</p>
<p>
  <em>모든 프로세스</em>-는 자신의 <code>PID</code> (<em>Process ID</em>)-와 부모프로세스의 <code>PPID</code>
  (<em>Parent</em>-)을 갖고 있으니, 내 프로그램의 하위프로세스 PID와 그 PID을
  부모로 하는 모든 프로세스를 찾아서 종료하면 되겠지.</p>
<p>
  그런데… 그 &#34;모든 프로세스&#34;, 혹은 &#34;자식 프로세스&#34;를 enumerate하는
  일이 플랫폼마다 다르다…🌋 baam! 히밤쾅.</p>
<ol>
<li>
<p>Python도 &#34;배터리&#34; 표준라이브러리에 없고, <a href="https://github.com/giampaolo/psutil">psutil</a> 사용</p>
<ul>
<li>어째서, 별거 아닌거 같은 라이브러리가 gh-stars⭐이 1.1만개나
받았을까…하고 내가 하려는 짓을 의심해 보아야 한다.</li>
</ul>
</li>
<li>
<p><a href="https://unix.stackexchange.com/questions/67668/elegantly-get-list-of-descendant-processes">&#34;Elegantly get list of descendant processes&#34;</a> 스택오버플로우</p>
<ul>
<li>&#34;우아하게&#34; 하위프로세스 목록을 구하는 방법에 대해 물었더니,
<code>ps</code>, <code>pstree</code>, <code>pgrep</code> 등의 유닉스 도구를 실행해서 그 출력을
파싱하라는 &#34;우아한가?&#34; 싶은 답변만 달려 있다.</li>
</ul>
</li>
</ol>
<p>
  실은, 정답은 아마 이럴 것 같다:</p>
<ol>
<li>
<p>리눅스라면,</p>
<ul>
<li>procfs <code>/proc</code>-을 디렉토리/파일 순회를 하면서 알아서 PID/PPID
정보를 모아서 사용해라.</li>
<li><a href="https://docs.kernel.org/filesystems/proc.html">https://docs.kernel.org/filesystems/proc.html</a> :
<code>/proc/${PID}/status</code> 파일에 <code>Pid:</code>, <code>PPid:</code> 필드가 친절하게
있다.🤣</li>
</ul>
</li>
<li>
<p>FreeBSD 쪽이라면,</p>
<ul>
<li>
<p>리눅스와 같이 procfs을 지원한다!</p>
<ul>
<li>하지만, 이걸 설정해놓는건 선택적 사항이므로… 🚷
<a href="https://man.freebsd.org/cgi/man.cgi?procfs">https://man.freebsd.org/cgi/man.cgi?procfs</a></li>
</ul>
</li>
<li><a href="https://man.freebsd.org/cgi/man.cgi?query=kvm_getprocs&amp;sektion=3&amp;n=1"><code>kvm_getnprocs(3)</code></a> 함수를 사용한다.</li>
</ul>
</li>
<li>Windows이라면: <a href="https://learn.microsoft.com/en-us/windows/win32/api/psapi/nf-psapi-enumprocesses"><code>EnumerateProcesses</code></a> 함수를 사용한다.</li>
<li>
<p>Mac OS X이라면,</p>
<ol>
<li>
<p><code>NSWorkspace</code> / <code>NSRunningApplication</code> 클래스를 사용한다. (AppKit)</p>
<ul>
<li><a href="https://stackoverflow.com/a/3338118">https://stackoverflow.com/a/3338118</a></li>
<li><a href="https://developer.apple.com/documentation/appkit/nsworkspace/runningapplications?language=objc">https://developer.apple.com/documentation/appkit/nsworkspace/runningapplications?language=objc</a></li>
</ul>
</li>
<li>BSD <code>sysctl</code>-을 쓰는 방법도 있는거 같지만, 이식성과 편의성
면에서는 …AppKit 쓰는거보다 딱히 나을게 없는거 같아서
…넘어가자.</li>
</ol>
</li>
</ol>
<p>
  그렇다. psutil 같은 별도 패키지가 아예 따로 있고,
  &#34;Cross-platform!&#34;이라고 마빡에 써붙인데에는 다 이유가 있던 것이다.</p>
<img src="/posts/2025-12dec/fuxx-it-bird.jpg" alt="/posts/2025-12dec/fuxx-it-bird.jpg" title="/posts/2025-12dec/fuxx-it-bird.jpg" width="600px"/>
<p>
  개인적으로 선호하는 방식은(빈정거리기는 했었어도), 특별한 시스템
  호출이 필요 없는 procfs 방식으로 노출하는게 맞다고 생각한다.
  <a href="https://en.wikipedia.org/wiki/Procfs">https://en.wikipedia.org/wiki/Procfs</a> …어쨌든 userland 구현
  라이브러리에서 호환성 생각 않고 접근하기도 좋으니까.</p>
<p>
  내가 좋아하는 것과 상관없이, 현실에선 모든 플랫폼에 적용하기 어렵다.</p>
<p>
  그런데, 이런 &#34;하위프로세스의 정리&#34;-같은건 일반적인 상황이라 남들도
  충분히 고민을 해왔을 것 같은데, 정말 겨우 이런 수준까지만
  가능한걸까?</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
[접근법] <code>kill -- -${PGID}</code>
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>현대의 유닉스는 이런 문제를 위해 (<code>PID</code> 이외에) &#34;Process Group&#34;
  개념을 지원한다. 👉<a href="https://en.wikipedia.org/wiki/Process_group">위키백과</a> ..이 글에선 &#34;Session ID&#34; 대신 &#34;Process
  Group&#34;-만 소개하겠음. (이유는 이후 &#34;차이점&#34; 섹션 참고)</p>
<p>
  하옇튼, 이를 위해 <code>kill(1)</code> manpage에선 다음과 같이 설명:</p>
<blockquote>
<p><code>kill -SIGTERM -123</code></p>
<p>
  Send  the signal SIGTERM to process group 123.</p>
<p>
  The signal name or number is required if specifying
  process groups with a negative PID.</p>
</blockquote>
<p>
  혹은 다음과 같이 실행해도 된다: <code>kill -- -123</code></p>
<p>
  &#34;<code>-${PID}</code>&#34; 같이 표기하면, &#34;123&#34;부분이 SIGNO인줄 알고 제대로 동작 않으니
  <code>--</code>-으로 구분. 보내는 시그널은아마 기본인 <code>SIGTERM</code>.</p>
<p>
  💲 <span style="text-decoration: underline;">PGID을 PID처럼(대신 &#34;-&#34;을 앞에 붙여서), 지정하면 해당
  process-group의 프로세스를 종료해준다.</span></p>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Session ID와의 차이점?
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>구글 검색하니 AI이 다음과 같이 정리해준다:</p>
<ol>
<li><code>setpgrp()</code>-은 <strong>현재 세션</strong>-에서 프로그램그룹만을 분리.</li>
<li><code>setsid()</code>-은 완전히 <strong>새로운 세션</strong>-을 시작하고, 현재
터미널(pty등)에서 프로세스를 분리(detached)한다.</li>
<li><code>setid</code>-이 더 격리된 환경을 만들지만, 프로세스 daemonization등에
더 적합.</li>
<li>반면 <code>setpgrp</code>-은 프로세스제어, 즉 내가 하려는 하위프로세스의
정리에 더 적합. (혹은 딱 그 정도에 부합)</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
[실험] process-group 지정해보기
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>
  하위프로세스으로 예시로 쓰기 위해, 무한루프 + 1초마다 시각을 찍는
  간단한 프로그램을 만들었다:</p>
<div class="src src-perl">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a class="lnlinks" href="#1">1</a>
</span><span class="lnt" id="2"><a class="lnlinks" href="#2">2</a>
</span><span class="lnt" id="3"><a class="lnlinks" href="#3">3</a>
</span><span class="lnt" id="4"><a class="lnlinks" href="#4">4</a>
</span><span class="lnt" id="5"><a class="lnlinks" href="#5">5</a>
</span><span class="lnt" id="6"><a class="lnlinks" href="#6">6</a>
</span><span class="lnt" id="7"><a class="lnlinks" href="#7">7</a>
</span><span class="lnt" id="8"><a class="lnlinks" href="#8">8</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">  <span class="c1">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># clock.pl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span> <span class="s">&#34;&#34;</span> <span class="o">.</span> <span class="nb">localtime</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">sleep</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
(naïve) <code>system()</code> == 👌
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<div class="src src-perl">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a class="lnlinks" href="#1">1</a>
</span><span class="lnt" id="2"><a class="lnlinks" href="#2">2</a>
</span><span class="lnt" id="3"><a class="lnlinks" href="#3">3</a>
</span><span class="lnt" id="4"><a class="lnlinks" href="#4">4</a>
</span><span class="lnt" id="5"><a class="lnlinks" href="#5">5</a>
</span><span class="lnt" id="6"><a class="lnlinks" href="#6">6</a>
</span><span class="lnt" id="7"><a class="lnlinks" href="#7">7</a>
</span><span class="lnt" id="8"><a class="lnlinks" href="#8">8</a>
</span><span class="lnt" id="9"><a class="lnlinks" href="#9">9</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">  <span class="c1">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># w-system.pl</span>
</span></span><span class="line"><span class="cl">  <span class="nb">system</span><span class="p">(</span><span class="s">&#39;./clock.pl&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cp">__END__
</span></span></span><span class="line"><span class="cl"><span class="cp">  $ ps j
</span></span></span><span class="line"><span class="cl"><span class="cp">     PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
</span></span></span><span class="line"><span class="cl"><span class="cp">     1916    2444    2444    2444 pts/0       2444 Ss+   1000   0:00 perl ./w-system.pl
</span></span></span><span class="line"><span class="cl"><span class="cp">     2444    2445    2444    2444 pts/0       2444 S+    1000   0:00 perl ./clock.pl</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<ol>
<li>
<p>위와 같이 짜서 <code>clock.pl</code> 실행하고,</p>
<ol>
<li>다른 터미널에서 <code>ps j</code>-을 실행한 결과를 붙여 넣었다: (L-5 이하)</li>
</ol>
</li>
<li>PGID=2444으로 동일하게 설정되고, 원 호출PID와 같다. (자동으로 설정됨.)</li>
</ol>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
<code>IPC::Open3</code> == 👌
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<div class="src src-perl">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a class="lnlinks" href="#1"> 1</a>
</span><span class="lnt" id="2"><a class="lnlinks" href="#2"> 2</a>
</span><span class="lnt" id="3"><a class="lnlinks" href="#3"> 3</a>
</span><span class="lnt" id="4"><a class="lnlinks" href="#4"> 4</a>
</span><span class="lnt" id="5"><a class="lnlinks" href="#5"> 5</a>
</span><span class="lnt" id="6"><a class="lnlinks" href="#6"> 6</a>
</span><span class="lnt" id="7"><a class="lnlinks" href="#7"> 7</a>
</span><span class="lnt" id="8"><a class="lnlinks" href="#8"> 8</a>
</span><span class="lnt" id="9"><a class="lnlinks" href="#9"> 9</a>
</span><span class="lnt" id="10"><a class="lnlinks" href="#10">10</a>
</span><span class="lnt" id="11"><a class="lnlinks" href="#11">11</a>
</span><span class="lnt" id="12"><a class="lnlinks" href="#12">12</a>
</span><span class="lnt" id="13"><a class="lnlinks" href="#13">13</a>
</span><span class="lnt" id="14"><a class="lnlinks" href="#14">14</a>
</span><span class="lnt" id="15"><a class="lnlinks" href="#15">15</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">  <span class="c1">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># w-popen3.pl</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">IPC::Open3</span> <span class="sx">qw( open3 )</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="s">&#34;./clock.pl&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$pid</span> <span class="o">=</span> <span class="n">open3</span><span class="p">(</span><span class="nb">undef</span><span class="p">,</span> <span class="s">&#39;&gt;&amp;STDOUT&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&amp;STDERR&#39;</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nb">waitpid</span><span class="p">(</span> <span class="nv">$pid</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="cp">__END__
</span></span></span><span class="line"><span class="cl"><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">  $ ps j
</span></span></span><span class="line"><span class="cl"><span class="cp">    PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
</span></span></span><span class="line"><span class="cl"><span class="cp">     1916    2869    2869    2869 pts/0       2869 Ss+   1000   0:00 perl ./w-popen3.pl
</span></span></span><span class="line"><span class="cl"><span class="cp">     2869    2870    2869    2869 pts/0       2869 S+    1000   0:00 perl ./clock.pl</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<ol>
<li>이번에는 조금 더 복잡한 경우를 대비해서, <code>IPC::Open3</code> 패키지를
사용해봄.</li>
<li>역시 잘 동작함을 확인.</li>
</ol>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
<code>fork</code> + <code>exec</code> == 👌
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<div class="src src-perl">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a class="lnlinks" href="#1"> 1</a>
</span><span class="lnt" id="2"><a class="lnlinks" href="#2"> 2</a>
</span><span class="lnt" id="3"><a class="lnlinks" href="#3"> 3</a>
</span><span class="lnt" id="4"><a class="lnlinks" href="#4"> 4</a>
</span><span class="lnt" id="5"><a class="lnlinks" href="#5"> 5</a>
</span><span class="lnt" id="6"><a class="lnlinks" href="#6"> 6</a>
</span><span class="lnt" id="7"><a class="lnlinks" href="#7"> 7</a>
</span><span class="lnt" id="8"><a class="lnlinks" href="#8"> 8</a>
</span><span class="lnt" id="9"><a class="lnlinks" href="#9"> 9</a>
</span><span class="lnt" id="10"><a class="lnlinks" href="#10">10</a>
</span><span class="lnt" id="11"><a class="lnlinks" href="#11">11</a>
</span><span class="lnt" id="12"><a class="lnlinks" href="#12">12</a>
</span><span class="lnt" id="13"><a class="lnlinks" href="#13">13</a>
</span><span class="lnt" id="14"><a class="lnlinks" href="#14">14</a>
</span><span class="lnt" id="15"><a class="lnlinks" href="#15">15</a>
</span><span class="lnt" id="16"><a class="lnlinks" href="#16">16</a>
</span><span class="lnt" id="17"><a class="lnlinks" href="#17">17</a>
</span><span class="lnt" id="18"><a class="lnlinks" href="#18">18</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">  <span class="c1">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># w-fork-exec.pl</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$child</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$child</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nb">waitpid</span> <span class="nv">$child</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exec</span> <span class="s">&#39;./clock.pl&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cp">__END__
</span></span></span><span class="line"><span class="cl"><span class="cp">  $ ps j
</span></span></span><span class="line"><span class="cl"><span class="cp">     PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
</span></span></span><span class="line"><span class="cl"><span class="cp">     1916    3144    3144    3144 pts/2       3144 Ss+   1000   0:00 perl ./w-fork-exec.pl
</span></span></span><span class="line"><span class="cl"><span class="cp">     3144    3145    3144    3144 pts/2       3144 S+    1000   0:00 perl ./clock.pl</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<ol>
<li>이렇게도 잘 동작. ㅎㅎ</li>
</ol>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
직접 ⚙️제어하기: <code>setpgrp</code> == 👌
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<p>
   다음처럼 <code>setpgrp</code> 직접 호출해서, 원하는 시점/프로세스에서 pgrp을
   새로 시작해도 됨:</p>
<div class="src src-perl">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a class="lnlinks" href="#1"> 1</a>
</span><span class="lnt" id="2"><a class="lnlinks" href="#2"> 2</a>
</span><span class="lnt" id="3"><a class="lnlinks" href="#3"> 3</a>
</span><span class="lnt" id="4"><a class="lnlinks" href="#4"> 4</a>
</span><span class="lnt" id="5"><a class="lnlinks" href="#5"> 5</a>
</span><span class="lnt" id="6"><a class="lnlinks" href="#6"> 6</a>
</span><span class="lnt" id="7"><a class="lnlinks" href="#7"> 7</a>
</span><span class="lnt" id="8"><a class="lnlinks" href="#8"> 8</a>
</span><span class="lnt" id="9"><a class="lnlinks" href="#9"> 9</a>
</span><span class="lnt" id="10"><a class="lnlinks" href="#10">10</a>
</span><span class="lnt" id="11"><a class="lnlinks" href="#11">11</a>
</span><span class="lnt" id="12"><a class="lnlinks" href="#12">12</a>
</span><span class="lnt" id="13"><a class="lnlinks" href="#13">13</a>
</span><span class="lnt" id="14"><a class="lnlinks" href="#14">14</a>
</span><span class="lnt" id="15"><a class="lnlinks" href="#15">15</a>
</span><span class="lnt" id="16"><a class="lnlinks" href="#16">16</a>
</span><span class="lnt" id="17"><a class="lnlinks" href="#17">17</a>
</span><span class="lnt" id="18"><a class="lnlinks" href="#18">18</a>
</span><span class="lnt" id="19"><a class="lnlinks" href="#19">19</a>
</span><span class="lnt" id="20"><a class="lnlinks" href="#20">20</a>
</span><span class="lnt" id="21"><a class="lnlinks" href="#21">21</a>
</span><span class="lnt" id="22"><a class="lnlinks" href="#22">22</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">  <span class="c1">#!/usr/bin/env perl</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># w-fork-exec-2.pl</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$child</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$child</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&#34;PARENT-PGID: &#34;</span><span class="p">,</span> <span class="nb">getpgrp</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">waitpid</span> <span class="nv">$child</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&#34;MY-PGID (BEFORE): &#34;</span><span class="p">,</span> <span class="nb">getpgrp</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">setpgrp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&#34;MY-PGID (NOW): &#34;</span><span class="p">,</span> <span class="nb">getpgrp</span><span class="p">,</span> <span class="s">&#34;\n&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exec</span> <span class="s">&#39;./clock.pl&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cp">__END__
</span></span></span><span class="line"><span class="cl"><span class="cp">  $ ps j
</span></span></span><span class="line"><span class="cl"><span class="cp">     PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND
</span></span></span><span class="line"><span class="cl"><span class="cp">     1916    4064    4064    4064 pts/0       4064 Ss+   1000   0:00 perl ./w-fork-exec-2.pl
</span></span></span><span class="line"><span class="cl"><span class="cp">     4064    4065    4065    4064 pts/0       4064 S     1000   0:00 perl ./clock.pl</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<ul>
<li><a href="https://perldoc.perl.org/functions/setpgrp">perldoc: setpgrp</a></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
Windows에서는?
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p><code>setpgrp</code>-은 아마 제대로 동작하지 않을 것 같다.</p>
<ol>
<li>
<p><code>CreateProcess</code> API:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags">https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags</a></li>
<li><code>CREATE_NEW_PROCESS_GROUP</code> (<code>0x00000200</code>)</li>
</ul>
</li>
</ol>
<blockquote>
<p>The new process is the root process of a new process group. </p>
<p>
   The process group includes all processes that are descendants of
this root process.</p>
<p>
   The process identifier of the new process group is the same as the
process identifier, which is returned in the <code>lpProcessInformation</code>
parameter. </p>
<p>
Process groups are used by the <code>GenerateConsoleCtrlEvent</code>
function to enable sending a CTRL+BREAK signal to a group of console
processes. If this flag is specified, CTRL+C signals will be disabled
for all processes within the new process group. This flag is ignored
if specified with <code>CREATE_NEW_CONSOLE</code>.</p>
</blockquote>
<p>
   …그리고 흔히 사용하는 <code>TerminateProcess</code> API은 이렇게 동작 않을거
   같다. 차라리 <code>taskkill /F /PID ${PID} /T</code>-와 같이 커맨드라인
   유틸리티를 사용하라고 하는거 같다. (…그리고 이건 아마도 &#34;프로세스
   나열하기&#34;-방식으로 하위프로세스를 찾아서 종료하겠지 싶다. ㅎㅎ
   procmon으로 확인해봐도 재밌을거 같다.)</p>
<p>
   안습한 점은, node.js의 &#34;kill-process-group&#34; 패키지를 봐도, 윈도에선
   그냥 taskkill 유틸리티를 호출한다. (윈도 지원이라고 해서 설레였었다…)</p>
<p>
   <a href="https://github.com/Kikobeats/kill-process-group/blob/39ce518916c746d1445aba4ffdab8bf59d001874/src/index.js#L10">https://github.com/Kikobeats/kill-process-group/blob/39ce518916c746d1445aba4ffdab8bf59d001874/src/index.js#L10</a></p>
<p>
   결국:</p>
<ol>
<li>
<p>윈도에서도 process-group을 흉내내려고 하려면,</p>
<ol>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/job-objects">https://learn.microsoft.com/en-us/windows/win32/procthread/job-objects</a>
을 쓰는게 가장 맞는 방법인 것 같다.</p>
<ul>
<li>(내가 프로세스를 시작한다면)</li>
</ul>
</li>
</ol>
</li>
<li>그게 아니라면, 그냥 enumerate =&gt; terminate 방식으로 구현하는게
맞을 것 같다.</li>
</ol>
</div>
</div>
<div id="outline-container-headline-11" class="outline-2">
<h2 id="headline-11">
[Addendum] <code>cgroups</code> – 갑자기 docker &amp; kubernetes
</h2>
<div id="outline-text-headline-11" class="outline-text-2">
<p>정말 별거 아닌 일을 하기 위해서 process-group으로 분리하고 하는
  일들을 보였는데, 의외로 이런 방식들이 발전을 계속하여 현재의
  경량가상화 / 혹은 컨테이너화를 위한 단계까지 온 것 같다.</p>
<p>
  pgrp만이 아니라 다른 <a href="https://en.wikipedia.org/wiki/Chroot">chroot</a> 같은 &#34;오래된&#34; 유닉스개념들이 더해지고
  발전하여 현대의 docker / kubernetes 같은 경량컨테이너화 기술의
  기반이 되었다.</p>
<p>
  👉 LWN <a href="https://lwn.net/Articles/603762/">Control groups, part 1: On the history of process grouping</a></p>
</div>
</div>

	</section><div class="post-tags">
	    
	    
	    <nav class="nav tags">
		<ul class="tags">
		    
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/linux/">linux</a>
                        <sup>27</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/perl/">perl</a>
                        <sup>15</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/freebsd/">freebsd</a>
                        <sup>11</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/unix/">unix</a>
                        <sup>5</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/docker/">docker</a>
                        <sup>2</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/windows-api/">windows-api</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/vfs/">vfs</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/plan9/">plan9</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/kubernetes/">kubernetes</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/k8s/">k8s</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/cgroups/">cgroups</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/system/">system</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/exec/">exec</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/fork/">fork</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/ipc-open3/">ipc-open3</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/sigterm/">sigterm</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/sigint/">sigint</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/aria2c/">aria2c</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/aria2/">aria2</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/yt-dlp/">yt-dlp</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/darwin/">darwin</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/osx/">osx</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/procfs/">procfs</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/sid/">sid</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/pgid/">pgid</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/pid/">pid</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/pgrp/">pgrp</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/signal/">signal</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/kill/">kill</a>
                        <sup>1</sup>
                    </li>
		    
		    <li class="tagbutton-inline">
                        🏷️ <a href="/tags/posix/">posix</a>
                        <sup>1</sup>
                    </li>
		    
		</ul>
	    </nav>
	    
	    
	</div>
    </article>

    <hr class="archive-ruler">

    <style>
     :root {--bg-big-emoji: "🐮";}
    </style>

    <nav class="post-prevnext" aria-label="posts">
    <span class="post-prevnext-side">
        
        <a class="post-prevnext-btn" href="https://ageldama.github.io/posts/2025-12dec/factor-and-io/">⬅️ (주절주절) Factor와 Io</a>
        
    </span>

    <span class="post-prevnext-side">
        
        <a class="post-prevnext-btn" href="https://ageldama.github.io/posts/2025-12dec/reactjs&#43;nextjs-rce/">➡️ (주절주절) react.js / next.js RCE 보안문제와 아기 히틀러 딜레마</a>
        
    </span>
</nav>

</main>
<footer class="global-footer">
    2026  © <a href='/myself'>ageldama</a> 👾  | Built with <a href="https://gohugo.io">Hugo</a> + <a href="https://github.com/ageldama/young40er-hugo-theme/">young40er theme</a> <code>1770717491</code> | Subscribe <a href="/index.xml" >📡 RSS</a>
</footer>



<script async src="https://www.googletagmanager.com/gtag/js?id=G-YSB7MGHZ4V"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 gtag('config', 'G-YSB7MGHZ4V', { cookie_flags: 'SameSite=None;Secure' });
</script>



</div>
    </body>
</html>
